<!-- public/List/products.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Products</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: 10px; border: 1px solid #ddd; }
    th { background-color: #f5f5f5; }
    input, select { padding: 6px; margin-right: 5px; }
    button { padding: 6px 10px; }
  </style>
</head>
<body>
  <h1>Products</h1>

  <div>
    <input id="name" placeholder="Product Name" />
    <select id="category"></select>
    <input id="price" type="number" placeholder="Price" />
    <input id="price1" type="number" placeholder="Price 1" />
    <input id="price2" type="number" placeholder="Price 2" />
    <input id="price3" type="number" placeholder="Price 3" />
    <button onclick="addProduct()">Add Product</button>
  </div>

  <table id="productTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Category</th>
        <th>Price</th>
        <th>Price1</th>
        <th>Price2</th>
        <th>Price3</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
<div id="editModal" style="display:none; padding: 1rem; border: 1px solid #ccc; background: #f9f9f9;">
  <h3>Edit Product</h3>
  <input type="hidden" id="editId">
  <div>
    <label>Name:</label>
    <input type="text" id="editName">
  </div>
  <div>
    <label>Category:</label>
    <select id="editCategory"></select>
  </div>
  <div>
    <label>Price:</label>
    <input type="number" id="editPrice">
  </div>
  <div>
    <label>Price 1:</label>
    <input type="number" id="editPrice1">
  </div>
  <div>
    <label>Price 2:</label>
    <input type="number" id="editPrice2">
  </div>
  <div>
    <label>Price 3:</label>
    <input type="number" id="editPrice3">
  </div>
  <button onclick="updateProduct()">Save</button>
  <button onclick="closeEditModal()">Cancel</button>
</div>

  <script>
    async function fetchCategories() {
      const res = await fetch("/api/categories");
      const data = await res.json();
      const select = document.getElementById("category");
      select.innerHTML = data.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join("");
    }

    async function fetchProducts() {
      const res = await fetch("/api/products");
      const data = await res.json();
      const tbody = document.querySelector("#productTable tbody");
      tbody.innerHTML = data.map(p => `
        <tr>
          <td>${p.id}</td>
          <td>${p.name}</td>
          <td>${p.category || "-"}</td>
          <td>${p.price || "-"}</td>
          <td>${p.price1 || "-"}</td>
          <td>${p.price2 || "-"}</td>
          <td>${p.price3 || "-"}</td>
          <td><button onclick="deleteProduct(${p.id})">Delete</button></td>
          <td>
          <button onclick="editProduct(${product.id})">‚úèÔ∏è Edit</button>
          <button onclick="deleteProduct(${product.id})">üóë Delete</button>
          </td>
        </tr>
      `).join("");
    }

async function addProduct() {
  const name = document.getElementById("name").value;
  const category_id = document.getElementById("category").value;
  const price = document.getElementById("price").value;

  // Optional fields - convert empty strings to null
  const price1 = document.getElementById("price1").value || null;
  const price2 = document.getElementById("price2").value || null;
  const price3 = document.getElementById("price3").value || null;

  const res = await fetch("/api/products", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name,
      category_id,
      price,
      price1,
      price2,
      price3
    }),
  });

  if (res.ok) {
    alert("‚úÖ Product saved successfully");
    location.reload();
  } else {
    alert("‚ùå Failed to save product");
  }
}

    async function deleteProduct(id) {
      if (!confirm("Delete this product?")) return;
      await fetch(`/api/products/${id}`, { method: "DELETE" });
      fetchProducts();
    }

    fetchCategories();
    fetchProducts();
  </script>
</body>
</html>
